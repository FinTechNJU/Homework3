# 后端界面设计报告

小组成员：李康，李向阳，肖扬，贾乃轩

2018.5.19

## 后端界面功能思维导图
![后端](/FinTechExchange/Img/后端.png)
#### 模块设计
<center>
<table border='1'>
<tr>
<th>模块名称</th>
<td>用户登录，注册，登出</td>
<td>订单处理</td>
<td>交易过程</td>
</tr>
<tr>
<th>模块概要</th>

<td>
用户输入账户密码实现登录</br>
用户注册需要输入邮箱进行验证后作为账号，输入密码，再次输入密码验证</br>
用户登出，退出当前账号
</td>
<td>
用户登录后可提交订单，订单包括：订单价格、订单数量、订单类型（买、卖）、订单时间、订单股票（将要交易的股票类型）、订单用户</br>
验证用户是否已经登录</br>
验证订单价格是否符合要求</br>
订单删除功能，若订单还未交易，可以选择删除该订单</br>
订单查看功能，查看订单详情、订单状态（已交易（从所有record中查找）、正在交易（从订单簿中查找））
</td>
<td>
将订单更新进入订单簿，订单簿按照股票类型，交易类型（买、卖）分开储存</br>
订单簿包括：(1)按照用户ID索引的所有该股票类型、交易类型的订单(2)按照价格索引的订单，订单按照时间顺序生成列表(3)简化的价格索引订单，价格、该价格总交易数量</br>
交易过程：(1)新订单进入，判断交易类型 (2)判断是否可以进行交易（买价大于卖价按卖价交易，卖价小于买价按买价交易）(3)记录交易（交易时间，卖家ID，买家ID，交易价格，交易数量），交易记录储存，交易记录展示（用户可以查看自己的交易记录，所有用户可以查看交易记录的价格数量时间，成功交易的订单生成股票价格图表）(4)未交易订单储存</br>
当前订单展示：显示还未交易的订单（股票类型，交易类型，订单数量，订单价格）

</td>
</tr>
</table>
</center>


## 数据表设计
![db](/FinTechExchange/Img/db.png)
#### user 表

| 字段名    | 数据类型     | 默认值 | 属性            | 说明                     |
|-----------|--------------|--------|-----------------|--------------------------|
| id        | int(11)      | -      | PRIMARYKEY      | 用户的id，唯一标识主键   |
| email | varchar(256) | -      | NOT NULL UNIQUE | 用户的邮箱               |
| username  | varchar(128) | -      | NOT NULL UNIQUE | 用户的用户名             |
| password  | varchar(256) | -      | NOT NULL        | 加密后的用户密码，密文   |
| user_type | tinyint      | 1      | NOT NULL        | 用户类型，默认为普通用户 |

#### stock表

| 字段名 | 数据类型     | 默认值 | 属性            | 说明                  |
|--------|--------------|--------|-----------------|-----------------------|
| id     | int(11)      | -      | PRIMARY KEY     | 股票的id,唯一标识股票 |
| code   | int(11)      | -      | NOT NULL UNIQUE | 股票的代码            |
| name   | varchar(128) | -      | NOT NULL        | 股票的名称            |
| desc   | mediumtext   | NULL   | -               | 股票的描述            |
| price  | real         | -      | NOT NULL        | 股票的最新价格        |
| time   | datetime     | -      | NOT NULL        | 此价格对应的时间点         |

#### order表

| 字段名           | 数据类型 | 默认值 | 属性        | 说明                               |
|------------------|----------|--------|-------------|------------------------------------|
| id               | int(11)  | -      | PRIMARY KEY | order的id，标识一笔交易            |
| stock_id         | int(11)  | -      | NOT NULL    | 此笔订单对应的股票id，与股票表关联 |
| buyer_id         | int(11)  | -      | NOT NULL    | 此笔订单的买入方的id               |
| seller_id        | int(11)  | -      | NOT NULL    | 此笔订单的卖方的id，与用户表关联   |
| type             | tinyint  | 0      | NOT NULL    | 买 or 卖                           |
| status           | tinyint  | 0      | NOT NULL    | 完成与否                           |
| price            | real     | -      | NOT NULL    | 订单单价                           |
| amount           | int(11)  | -      | NOT NULL    | 订单数量                           |
| publish_time     | datetime | -      | NOT NULL    | 发布时间                           |
| transcation_time | datetime | - | NOT NULL            | 交易完成时间                       |

#### balance表

| 字段名           | 数据类型 | 默认值 | 属性        | 说明                     |
|------------------|----------|--------|-------------|--------------------------|
| id               | int(11)  | -      | PRIMARY KEY | balance的id              |
| user_id          | int(11)  | -      | NOT NULL    | 关联到user表，对应的用户 |
| stock_id         | int(11)  | -      | NOT NULL    | 对应的股票id，0表示法币  |
| amount_total     | int(11)  | -      | NOT NULL    | 总数量                   |
| amount_available | int(11)  | -      | NOT NULL    | 除去已经发布的卖单之后的数量，保证用户发布的卖单有效 |






## 后端开发语言、框架
* 开发语言：python
* 开发框架：django
* 开发模式：MVC(模型，视图，控制器)

### 完成进度
* 基本实现股票交易所的主体功能，并测试通过。详见[Exchange.py](/FinTechExchange/Exchange.py)
* 主体功能实现，接下来使用Django框架，搭建网站
* 创建了虚拟环境、搭建了基础框架、实现了用户管理、创建了部署环境

### 小组分工
|人员|分工|
|:-:|:-:|
|李康|编制设计报告、流程图、交易者功能、完成用户模型、搭建虚拟环境、搭建部署环境、实现了用户管理|
|肖扬|实现股票功能、实现订单功能、实现订单薄功能、实现交易功能、实现市场功能、实现交易者功能、实现了限价订单功能|
|李向阳|设计数据表、绘制数据表图、搭建网站框架、实现了部分前段框架|
|贾乃轩|编制设计报告、绘制流程图、实现随机交易机器人|
